<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spyder2000</title>

  <style>
    /* Load authentic 7-segment display font from CDN */
    @import url('https://cdn.jsdelivr.net/npm/dseg@latest/css/dseg.min.css');

    /* CRITICAL: WebView constraints - NO viewport units */
    html, body {
      height: 100%;  /* REQUIRED - replaces viewport units */
      margin: 0;
      padding: 0;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      /* Native application feel */
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      cursor: default;
      overflow: hidden;

      /* Full window display */
      display: flex;
      align-items: stretch;
      justify-content: stretch;
      background: #000;
      font-family: Arial, sans-serif;
    }

    /* Plugin UI container with 5px rounded corners and BEVELED EDGES */
    .container {
      width: 100%;
      height: 100%;
      position: relative;
      border-radius: 5px;
      overflow: hidden;

      /* v5: Glossy polished Ferrari Red chassis */
      /* Multiple gradient layers for highly polished aluminum look */
      background:
        /* Top gloss layer (specular highlight) */
        radial-gradient(
          circle at 30% 30%,
          rgba(255, 255, 255, 0.35) 0%,
          rgba(255, 107, 107, 0.2) 15%,
          transparent 40%
        ),
        /* Mid-tone gradient (Ferrari Red base) */
        radial-gradient(
          ellipse at 50% 33%,
          #FF1744 0%,
          #DC143C 50%,
          #8B0000 100%
        );

      /* v5: Hammond 1590BB style beveled edges */
      box-shadow:
        /* Outer bevel (top-left light) */
        inset 0 0 0 1px rgba(255, 255, 255, 0.15),
        inset 8px 8px 12px rgba(255, 107, 107, 0.4),
        inset -8px -8px 12px rgba(90, 0, 0, 0.6),
        /* Mid bevel layer */
        inset 4px 4px 8px rgba(255, 107, 107, 0.25),
        inset -4px -4px 8px rgba(90, 0, 0, 0.4),
        /* Inner bevel (closest to center) */
        inset 2px 2px 4px rgba(255, 107, 107, 0.15),
        inset -2px -2px 4px rgba(90, 0, 0, 0.3),
        /* Additional depth shadows for glossy finish */
        inset 0 0 20px rgba(0, 0, 0, 0.2),
        /* Outer depth shadow (3D lift) */
        0 4px 16px rgba(0, 0, 0, 0.7),
        /* Extra outer glow for polished effect */
        0 8px 24px rgba(220, 20, 60, 0.3);
    }

    /* Additional bevel detail using pseudo-elements */
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 8px;
      background: linear-gradient(
        to bottom,
        rgba(255, 107, 107, 0.5) 0%,
        rgba(255, 107, 107, 0.2) 50%,
        transparent 100%
      );
      border-radius: 5px 5px 0 0;
      pointer-events: none;
      z-index: 1;
    }

    .container::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 8px;
      background: linear-gradient(
        to top,
        rgba(90, 0, 0, 0.6) 0%,
        rgba(90, 0, 0, 0.3) 50%,
        transparent 100%
      );
      border-radius: 0 0 5px 5px;
      pointer-events: none;
      z-index: 1;
    }

    /* v5: Enhanced gloss overlay for polished chassis */
    .gloss-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background:
        /* Primary specular highlight */
        radial-gradient(
          circle at 25% 25%,
          rgba(255, 255, 255, 0.4) 0%,
          rgba(255, 255, 255, 0.2) 20%,
          rgba(255, 255, 255, 0.05) 40%,
          transparent 60%
        ),
        /* Secondary diffuse highlight */
        linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.25) 0%,
          rgba(255, 255, 255, 0.1) 50%,
          rgba(255, 255, 255, 0) 100%
        );
      pointer-events: none;
      border-radius: 5px 5px 0 0;
      z-index: 2;
    }

    /* v5: Plugin name - FLAT silkscreen (NO text-shadow) */
    .plugin-name {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Arial Black', sans-serif;
      font-size: 24px;
      font-weight: bold;
      color: #ffffff;
      /* Clean flat silkscreen appearance like real pedal */
      letter-spacing: 3px;
      z-index: 3;
    }

    /* Knob container */
    .knob-container {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      z-index: 3;
    }

    /* v5: Knob wrapper (holds rotating body + stationary shine) */
    .knob {
      width: 95px;
      height: 95px;
      position: relative;
      cursor: pointer;
    }

    /* v5: Rotating knob body (base + texture + indicator rotate together) */
    .knob-body {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: center center;
      transition: transform 50ms;
      z-index: 1;
    }

    /* Davies 1510 Knob base (rotates with body) */
    .knob-bg {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #000000;

      /* Black polished knob with subtle gradient */
      background: radial-gradient(
        circle at 30% 30%,
        #333333 0%,
        #1a1a1a 30%,
        #000000 60%,
        #000000 100%
      );

      /* Enhanced shadow for depth */
      box-shadow:
        inset -4px -4px 12px rgba(0, 0, 0, 0.9),
        inset 4px 4px 10px rgba(100, 100, 100, 0.4),
        0 6px 12px rgba(0, 0, 0, 0.6);

      position: relative;
    }

    /* Davies 1510 cylindrical texture (rotates with knob) */
    .knob-texture {
      position: absolute;
      width: 75%;
      height: 75%;
      top: 12.5%;
      left: 12.5%;
      border-radius: 50%;
      background: repeating-conic-gradient(
        from 0deg,
        #0a0a0a 0deg 1.5deg,
        #1a1a1a 1.5deg 3deg
      );
      opacity: 0.6;
    }

    /* Davies 1510 white marker (rotates with knob) */
    .knob-indicator {
      position: absolute;
      width: 3px;
      height: 32px;
      background: #ffffff;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 2px;
      box-shadow:
        0 0 4px rgba(255, 255, 255, 0.8),
        0 3px 6px rgba(0, 0, 0, 0.6);
    }

    /* v5: Stationary knob shine (does NOT rotate) */
    .knob-shine {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      pointer-events: none;  /* Don't block clicks */
      z-index: 2;  /* Above rotating body */

      /* Glossy highlight from top-left (STAYS FIXED) */
      background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.5) 0%,
        rgba(255, 255, 255, 0.25) 20%,
        rgba(255, 255, 255, 0.1) 35%,
        transparent 50%
      );
    }

    /* v5: Knob label - FLAT silkscreen (NO text-shadow) */
    .knob-label {
      font-size: 14px;
      font-weight: bold;
      color: #ffffff;
      /* Clean flat silkscreen appearance like real pedal */
      letter-spacing: 1px;
    }

    /* Authentic 7-segment display (shadows retained - simulates glowing LEDs) */
    .seven-segment-display {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 140px;
      height: 40px;
      background: #000000;
      border: 2px solid #333;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3;

      /* Actual 7-segment font (DSEG7 Classic) */
      font-family: 'DSEG7 Classic', 'DSEG7', 'Digital-7', 'Segment7', 'Courier New', monospace;
      font-size: 22px;
      font-weight: bold;
      color: #FF3333;

      /* Multiple text-shadow layers for authentic LED glow effect */
      /* RETAINED v5: This simulates actual glowing LEDs, not silkscreen text */
      text-shadow:
        0 0 5px #ff0000,
        0 0 10px #ff0000,
        0 0 15px #ff0000,
        0 0 20px #ff3333,
        0 0 30px #ff3333,
        0 0 40px #ff3333;

      letter-spacing: 3px;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Enhanced gloss overlay for polished chassis -->
    <div class="gloss-overlay"></div>

    <!-- Plugin name (v5: FLAT silkscreen, no shadow) -->
    <div class="plugin-name">SPYDER 2000</div>

    <!-- v5: Knobs with STATIONARY SHINE -->
    <!-- Gain knob -->
    <div class="knob-container" style="left: 57px; top: 60px;">
      <div class="knob" id="gain-knob" data-param="gain" data-value="5.0" data-min="0" data-max="10">
        <!-- Rotating body (knob base + texture + indicator) -->
        <div class="knob-body">
          <div class="knob-bg">
            <div class="knob-texture"></div>
            <div class="knob-indicator"></div>
          </div>
        </div>
        <!-- STATIONARY shine (does NOT rotate) -->
        <div class="knob-shine"></div>
      </div>
      <!-- v5: FLAT label (no shadow) -->
      <div class="knob-label">GAIN</div>
    </div>

    <!-- Tone knob -->
    <div class="knob-container" style="left: 177px; top: 60px;">
      <div class="knob" id="tone-knob" data-param="tone" data-value="5.0" data-min="0" data-max="10">
        <!-- Rotating body -->
        <div class="knob-body">
          <div class="knob-bg">
            <div class="knob-texture"></div>
            <div class="knob-indicator"></div>
          </div>
        </div>
        <!-- STATIONARY shine -->
        <div class="knob-shine"></div>
      </div>
      <!-- v5: FLAT label (no shadow) -->
      <div class="knob-label">TONE</div>
    </div>

    <!-- Level knob -->
    <div class="knob-container" style="left: 297px; top: 60px;">
      <div class="knob" id="level-knob" data-param="level" data-value="8.0" data-min="0" data-max="10">
        <!-- Rotating body -->
        <div class="knob-body">
          <div class="knob-bg">
            <div class="knob-texture"></div>
            <div class="knob-indicator"></div>
          </div>
        </div>
        <!-- STATIONARY shine -->
        <div class="knob-shine"></div>
      </div>
      <!-- v5: FLAT label (no shadow) -->
      <div class="knob-label">LEVEL</div>
    </div>

    <!-- Authentic 7-segment display with DSEG7 font (LED glow shadows retained) -->
    <div class="seven-segment-display" id="display">INSANE</div>
  </div>

  <script>
    // Disable context menu (REQUIRED for native application feel)
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    // Disable default drag behaviors
    document.addEventListener("dragstart", (e) => {
      e.preventDefault();
    });

    // Knob interaction state
    let activeKnob = null;
    let startY = 0;
    let startValue = 0;
    let displayTimeout = null;

    // JUCE parameter state tracking
    const parameterStates = {
      gain: null,
      tone: null,
      level: null
    };

    // Initialize JUCE parameter bindings
    function initializeJUCEBindings() {
      if (typeof window.Juce === 'undefined') {
        console.warn('JUCE backend not available - running in browser test mode');
        return;
      }

      // Get parameter state objects from JUCE
      parameterStates.gain = window.Juce.getSliderState("gain");
      parameterStates.tone = window.Juce.getSliderState("tone");
      parameterStates.level = window.Juce.getSliderState("level");

      // Set initial knob positions from JUCE
      updateKnobFromJUCE('gain-knob', parameterStates.gain);
      updateKnobFromJUCE('tone-knob', parameterStates.tone);
      updateKnobFromJUCE('level-knob', parameterStates.level);

      // Listen for parameter changes from JUCE (automation, preset recall)
      if (parameterStates.gain && parameterStates.gain.valueChangedEvent) {
        parameterStates.gain.valueChangedEvent.addListener(() => {
          updateKnobFromJUCE('gain-knob', parameterStates.gain);
        });
      }
      if (parameterStates.tone && parameterStates.tone.valueChangedEvent) {
        parameterStates.tone.valueChangedEvent.addListener(() => {
          updateKnobFromJUCE('tone-knob', parameterStates.tone);
        });
      }
      if (parameterStates.level && parameterStates.level.valueChangedEvent) {
        parameterStates.level.valueChangedEvent.addListener(() => {
          updateKnobFromJUCE('level-knob', parameterStates.level);
        });
      }
    }

    // Update knob visual from JUCE parameter state
    function updateKnobFromJUCE(knobId, paramState) {
      if (!paramState) return;

      const knob = document.getElementById(knobId);
      if (!knob) return;

      const min = parseFloat(knob.dataset.min);
      const max = parseFloat(knob.dataset.max);
      const normalizedValue = paramState.normalisedValue;
      const actualValue = min + (normalizedValue * (max - min));

      knob.dataset.value = actualValue.toFixed(1);
      updateKnobRotation(knob, actualValue, min, max);
    }

    // Initialize knobs with default values
    const knobs = document.querySelectorAll('.knob');
    knobs.forEach(knob => {
      const value = parseFloat(knob.dataset.value);
      const min = parseFloat(knob.dataset.min);
      const max = parseFloat(knob.dataset.max);
      updateKnobRotation(knob, value, min, max);
    });

    // Initialize JUCE bindings when ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeJUCEBindings);
    } else {
      initializeJUCEBindings();
    }

    // Mouse down - start dragging
    document.addEventListener('mousedown', (e) => {
      const knob = e.target.closest('.knob');
      if (!knob) return;

      activeKnob = knob;
      startY = e.clientY;
      startValue = parseFloat(knob.dataset.value);
      e.preventDefault();
    });

    // Mouse move - update knob value
    document.addEventListener('mousemove', (e) => {
      if (!activeKnob) return;

      const deltaY = startY - e.clientY;  // Inverted: up = increase
      const min = parseFloat(activeKnob.dataset.min);
      const max = parseFloat(activeKnob.dataset.max);
      const range = max - min;

      // 200px drag = full range
      const sensitivity = range / 200;
      let newValue = startValue + (deltaY * sensitivity);

      // Clamp to range
      newValue = Math.max(min, Math.min(max, newValue));

      // Update knob visual
      activeKnob.dataset.value = newValue.toFixed(1);
      updateKnobRotation(activeKnob, newValue, min, max);

      // Send to JUCE backend
      const paramId = activeKnob.dataset.param;
      const normalizedValue = (newValue - min) / range;

      if (parameterStates[paramId] && parameterStates[paramId].setNormalisedValue) {
        parameterStates[paramId].setNormalisedValue(normalizedValue);
      }

      // Update display
      const paramIdUpper = paramId.toUpperCase();
      const display = document.getElementById('display');
      display.textContent = `${paramIdUpper} ${newValue.toFixed(1)}`;

      // Reset display timeout
      clearTimeout(displayTimeout);
      displayTimeout = setTimeout(() => {
        display.textContent = 'INSANE';
      }, 2000);

      e.preventDefault();
    });

    // Mouse up - stop dragging
    document.addEventListener('mouseup', () => {
      activeKnob = null;
    });

    // v5: Rotate only .knob-body (shine stays stationary)
    function updateKnobRotation(knob, value, min, max) {
      const normalized = (value - min) / (max - min);  // 0 to 1
      const degrees = -135 + (normalized * 270);       // -135° to +135°

      // Apply rotation ONLY to .knob-body (not .knob-shine)
      const knobBody = knob.querySelector('.knob-body');
      if (knobBody) {
        knobBody.style.transform = `rotate(${degrees}deg)`;
      }

      // .knob-shine has NO transform - stays stationary!
    }

    console.log('Spyder2000 UI v5 loaded (PRODUCTION)');
    console.log('v5 features:');
    console.log('  - Flat silkscreen labels (authentic pedal aesthetic)');
    console.log('  - 5px rounded corners (Hammond 1590BB)');
    console.log('  - Stationary knob shine (Davies 1510 style)');
    console.log('  - Glossy Ferrari Red chassis');
    console.log('  - 7-segment display with LED glow');
  </script>
</body>
</html>
